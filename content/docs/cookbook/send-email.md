---
title: 'Sending emails with an AI agent'
description: 'Build an AI agent to send emails via Gmail'
author: 
  name: 'Alfred'
  title: 'Co-founder'
  img: '/alfred.jpg'
tags: ["Email"]
createdAt: 2025-04-03
updatedAt: 2025-04-03
---

# Sending emails with an AI agent

AI agents usually return the generated result in Terminal or a chat interface. But there are times when you might prefer to receive the result in an email. Or you might want to send the result to someone else via email.

In this simple example, our AI agent will make up a haiku about dreams and send it to a recipient via a Gmail account, using [our `silanthro/send-gmail` tool](https://github.com/silanthro/send-gmail/).

The `send_gmail` function takes the following arguments, which will be extracted from our request or generated by the AI agent:

- subject (str): The subject header of the email
- body (str): The contents of the email
- recipients (list\[str\]): A list of recipient email addresses 

It then sends the email and returns:
- A string, "Email sent successfully"

---

To get started, we first set the following environment variables in a `.env` file: 

- `GMAIL_ADDRESS`: The sender's email
- `GMAIL_PASSWORD`: The sender's [app password](https://myaccount.google.com/apppasswords), **not account password**
- `GMAIL_DISPLAY_NAME` (optional): The sender's display name
- `<COMPANY>_API_KEY`: The API key of the model you want to use

Now, we are ready to load the `send-gmail` tool and build our AI agent. 

Here are the scripts for the various major LLM providers and frameworks. Remember to install the required dependencies mentioned at the top of each script.

::content-multi-code
```python {4, 13-21, 31, 36} [Anthropic]
import os
import anthropic
from dotenv import load_dotenv
import stores

# Load environment variables
load_dotenv()

# Initialize Anthropic client
client = anthropic.Anthropic()

# Load tools and set the required environment variables
index = stores.Index(
    ["silanthro/send-gmail"],
    env_var={
        "silanthro/send-gmail": {
            "GMAIL_ADDRESS": os.environ["GMAIL_ADDRESS"],
            "GMAIL_PASSWORD": os.environ["GMAIL_PASSWORD"],
        },
    },
)

# Get the response from the model
response = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=1024,
    messages=[
        {"role": "user", "content": "Send a haiku about dreams to email@example.com"}
    ],
    # Pass tools
    tools=index.format_tools("anthropic"),
)

# Execute the tool call
tool_call = response.content[-1]
result = index.execute(tool_call.name, tool_call.input)
print(f"Tool output: {result}")

```
```python {5, 14-22, 25} [Gemini]
import os
from dotenv import load_dotenv
from google import genai
from google.genai import types
import stores

# Load environment variables
load_dotenv()

# Initialize Google Gemini client
client = genai.Client(api_key=os.environ["GEMINI_API_KEY"])

# Load tools and set the required environment variables
index = stores.Index(
    ["silanthro/send-gmail"],
    env_var={
        "silanthro/send-gmail": {
            "GMAIL_ADDRESS": os.environ["GMAIL_ADDRESS"],
            "GMAIL_PASSWORD": os.environ["GMAIL_PASSWORD"],
        },
    },
)

# Initialize the chat with the model and tools
config = types.GenerateContentConfig(tools=index.tools)
chat = client.chats.create(model="gemini-2.0-flash", config=config)

# Get the response from the model. Gemini will automatically execute the tool call.
response = chat.send_message(
    "Send a haiku about dreams to email@example.com. Don't ask questions."
)
print(f"Assistant response: {response.candidates[0].content.parts[0].text}")
```
```python {5, 14-22, 31, 36-39} [OpenAI]
import json
import os
from dotenv import load_dotenv
from openai import OpenAI
import stores

# Load environment variables
load_dotenv()

# Initialize OpenAI client
client = OpenAI()

# Load tools and set the required environment variables
index = stores.Index(
    ["silanthro/send-gmail"],
    env_var={
        "silanthro/send-gmail": {
            "GMAIL_ADDRESS": os.environ["GMAIL_ADDRESS"],
            "GMAIL_PASSWORD": os.environ["GMAIL_PASSWORD"],
        },
    },
)

# Get the response from the model
response = client.responses.create(
    model="gpt-4o-mini-2024-07-18",
    input=[
        {"role": "user", "content": "Send a haiku about dreams to email@example.com"}
    ],
    # Pass tools
    tools=index.format_tools("openai-responses"),
)

# Execute the tool call
tool_call = response.output[0]
result = index.execute(
    tool_call.name,
    json.loads(tool_call.arguments),
)
print(f"Tool output: {result}")
```
```python {4, 10-18, 22, 31} [LangChain]
import os
from dotenv import load_dotenv
from langchain_google_genai import ChatGoogleGenerativeAI
import stores

# Load environment variables
load_dotenv()

# Load tools and set the required environment variables
index = stores.Index(
    ["silanthro/send-gmail"],
    env_var={
        "silanthro/send-gmail": {
            "GMAIL_ADDRESS": os.environ["GMAIL_ADDRESS"],
            "GMAIL_PASSWORD": os.environ["GMAIL_PASSWORD"],
        },
    },
)

# Initialize the model with tools
model = ChatGoogleGenerativeAI(model="gemini-2.0-flash-001")
model_with_tools = model.bind_tools(index.tools)

# Get the response from the model
response = model_with_tools.invoke(
    "Send a haiku about dreams to email@example.com. Don't ask questions."
)

# Execute the tool call
tool_call = response.tool_calls[0]
result = index.execute(tool_call["name"], tool_call["args"])
print(f"Tool output: {result}")
```
```python {6, 12-20, 24} [LangGraph]
import os
from dotenv import load_dotenv
from langchain_core.messages import HumanMessage
from langchain_google_genai import ChatGoogleGenerativeAI
from langgraph.prebuilt import create_react_agent
import stores

# Load environment variables
load_dotenv()

# Load tools and set the required environment variables
index = stores.Index(
    ["silanthro/send-gmail"],
    env_var={
        "silanthro/send-gmail": {
            "GMAIL_ADDRESS": os.environ["GMAIL_ADDRESS"],
            "GMAIL_PASSWORD": os.environ["GMAIL_PASSWORD"],
        },
    },
)

# Initialize the LangGraph agent with the tools
agent_model = ChatGoogleGenerativeAI(model="gemini-2.0-flash-001")
agent_executor = create_react_agent(agent_model, index.tools)

# Get the response from the agent. The LangGraph agent will automatically
# execute the tool call.
response = agent_executor.invoke(
    {
        "messages": [
            HumanMessage(
                content="Send a haiku about dreams to email@example.com. Don't ask questions."
            )
        ]
    }
)
print(f"Assistant response: {response['messages'][-1].content}")
```
```python {6, 12-20, 23, 27} [LlamaIndex]
import os
from dotenv import load_dotenv
from llama_index.core.agent import AgentRunner
from llama_index.core.tools import FunctionTool
from llama_index.llms.google_genai import GoogleGenAI
import stores

# Load environment variables
load_dotenv()

# Load tools and set the required environment variables
index = stores.Index(
    ["silanthro/send-gmail"],
    env_var={
        "silanthro/send-gmail": {
            "GMAIL_ADDRESS": os.environ["GMAIL_ADDRESS"],
            "GMAIL_PASSWORD": os.environ["GMAIL_PASSWORD"],
        },
    },
)

# Wrap tools with LlamaIndex FunctionTool
tools = [FunctionTool.from_defaults(fn=fn) for fn in index.tools]

# Initialize the LlamaIndex agent with tools
llm = GoogleGenAI(model="models/gemini-2.0-flash-001")
agent = AgentRunner.from_llm(tools, llm=llm, verbose=True)

# Get the response from the LlamaIndex agent. The LlamaIndex agent will
# automatically execute the tool call.
response = agent.chat(
    "Send a haiku about dreams to email@example.com. Don't ask questions."
)
print(f"Assistant response: {response}")
```
```python {4,7-15, 27, 32-35} [LiteLLM]
import json
import os
from litellm import completion
import stores

# Load tools and set the required environment variables
index = stores.Index(
    ["silanthro/send-gmail"],
    env_var={
        "silanthro/send-gmail": {
            "GMAIL_ADDRESS": os.environ["GMAIL_ADDRESS"],
            "GMAIL_PASSWORD": os.environ["GMAIL_PASSWORD"],
        },
    },
)

# Get the response from the model
response = completion(
    model="gemini/gemini-2.0-flash-001",
    messages=[
        {
            "role": "user",
            "content": "Send a haiku about dreams to email@example.com. Don't ask questions.",
        }
    ],
    # Pass tools
    tools=index.format_tools("google-gemini"),
)

# Execute the tool call
tool_call = response.choices[0].message.tool_calls[0]
result = index.execute(
    tool_call.function.name,
    json.loads(tool_call.function.arguments),
)
print(f"Tool output: {result}")

```
::

In the folder where you have this script, you can run the AI agent with the command:

```bash
python send-email.py
```

The recipient should then receive an email with the haiku about dreams.

If you have any questions, let us know on [GitHub](https://github.com/silanthro/stores).